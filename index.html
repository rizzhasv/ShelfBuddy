<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShelfBuddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 min-h-screen font-sans p-4 md:p-8">

<div class="max-w-2xl mx-auto bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">
    
    <!-- HEADER -->
    <div class="bg-orange-500 p-6 text-white flex justify-between items-center">
        <h2 class="text-2xl font-bold">üè† ShelfBuddy</h2>
        <span class="text-xs bg-orange-600 px-3 py-1 rounded-full">Gemini Mode</span>
    </div>

    <div class="p-6 space-y-8">

        <!-- ADD ITEM -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 bg-slate-50 p-4 rounded-2xl">
            <input id="itemName" type="text" placeholder="Item Name"
                class="md:col-span-2 p-4 border rounded-xl focus:ring-2 focus:ring-orange-500 outline-none">

            <select id="itemLoc" class="p-4 border rounded-xl bg-white">
                <option>Fridge</option>
                <option>Pantry</option>
                <option>Freezer</option>
            </select>

            <button id="addBtn"
                class="md:col-span-3 bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 rounded-xl transition shadow-md active:scale-95 text-sm uppercase tracking-wider">
                Add to Inventory
            </button>
        </div>

        <!-- INVENTORY LIST -->
        <div>
            <h3 class="text-lg font-bold text-slate-800 mb-4">üì¶ Current Stash</h3>
            <div id="inventoryList" class="space-y-3 max-h-80 overflow-y-auto pr-2">
                <p class="text-slate-400 italic text-sm">No items yet</p>
            </div>
        </div>

        <!-- AI CHEF -->
        <div class="bg-gradient-to-br from-orange-50 to-yellow-50 p-6 rounded-3xl border border-orange-100 shadow-inner">
            <div class="flex items-center gap-3 mb-4">
                <span class="text-2xl">ü§ñ</span>
                <h3 class="text-orange-900 font-bold">Gemini AI Chef</h3>
            </div>

            <div id="aiOutput"
                class="text-sm text-orange-800 mb-5 italic leading-relaxed min-h-[40px]">
                Ready to cook?
            </div>

            <button id="aiBtn"
                class="w-full bg-orange-600 hover:bg-orange-700 text-white py-4 rounded-2xl font-bold transition shadow-md active:scale-95 uppercase text-xs tracking-widest">
                Get Recipe Idea
            </button>
        </div>

    </div>
</div>

<!-- SCRIPT -->
<script type="module">
    /* ---------------- FIREBASE ---------------- */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import {
        getFirestore, collection, addDoc, onSnapshot,
        deleteDoc, doc, serverTimestamp, query, orderBy
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCjhDnn_9INN-DlrvczYET3b2x-S4gbYUs",
        authDomain: "shelfbuddy-5b380.firebaseapp.com",
        projectId: "shelfbuddy-5b380",
        storageBucket: "shelfbuddy-5b380.appspot.com",
        messagingSenderId: "925894203959",
        appId: "1:925894203959:web:7e405ff12de8b549d2bdb2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentItems = [];

    /* ---------------- GEMINI ---------------- */
    import { GoogleGenerativeAI } from "https://cdn.jsdelivr.net/npm/@google/generative-ai@0.21.0/dist/index.mjs";


    const GEMINI_KEY = "AIzaSyAx2vSemS9QTgPa1HZ2I4VxjPoJjU2YjNQ";
    const genAI = new GoogleGenerativeAI(GEMINI_KEY);
    const model = genAI.getGenerativeModel({ model: "gemini-1.0-pro-latest" });

    /* ---------------- REALTIME INVENTORY ---------------- */
    const q = query(collection(db, "inventory"), orderBy("createdAt", "desc"));

    onSnapshot(q, (snapshot) => {
        const list = document.getElementById("inventoryList");
        list.innerHTML = "";
        currentItems = [];

        snapshot.forEach((docSnap) => {
            const data = docSnap.data();
            currentItems.push(`${data.name} (${data.location})`);

            const div = document.createElement("div");
            div.className =
                "flex justify-between items-center p-4 bg-white border rounded-xl shadow-sm";

            div.innerHTML = `
                <div>
                    <span class="font-bold">${data.name}</span>
                    <span class="ml-2 text-xs bg-slate-100 px-2 py-1 rounded-full">${data.location}</span>
                </div>
                <button class="text-red-400 font-bold">‚úï</button>
            `;

            div.querySelector("button").onclick = () =>
                deleteDoc(doc(db, "inventory", docSnap.id));

            list.appendChild(div);
        });

        if (currentItems.length === 0) {
            list.innerHTML = `<p class="text-slate-400 italic text-sm">No items yet</p>`;
        }
    });

    /* ---------------- ADD ITEM ---------------- */
    document.getElementById("addBtn").onclick = async () => {
        const name = itemName.value.trim();
        if (!name) return;

        await addDoc(collection(db, "inventory"), {
            name,
            location: itemLoc.value,
            createdAt: serverTimestamp()
        });

        itemName.value = "";
    };

    /* ---------------- AI BUTTON ---------------- */
    document.getElementById("aiBtn").onclick = async () => {
        if (currentItems.length === 0) {
            aiOutput.innerText = "Add some food first!";
            return;
        }

        aiOutput.innerText = "üë®‚Äçüç≥ Thinking...";

        try {
            const prompt = `
You are a friendly AI chef.
I have these items: ${currentItems.join(", ")}.
Suggest ONE quick, simple meal.
Keep it under 3 sentences.
            `;

            const result = await model.generateContent(prompt);
            aiOutput.innerText = result.response.text();
        } catch (e) {
            console.error(e);
            aiOutput.innerText = "‚ùå AI error. Try again.";
        }
    };
</script>

</body>
</html>
